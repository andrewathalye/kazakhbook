<grammar>
   <!-- Abstract features that can be possessed
        by various structures
   -->
   <features>
      <!-- Sound features -->
      <feature id="place">
         <value id="bilabial"/>
         <value id="labiodental"/>
         <value id="dental"/>
         <value id="alveolar"/>
         <value id="postalveolar"/>
         <value id="retroflex"/>
         <value id="palatal"/>
         <value id="velar"/>
         <value id="uvular"/>
         <value id="pharyngeal"/>
         <value id="glottal"/>

         <!-- For vowels -->
         <value id="front"/>
         <value id="frontcentral"/>
         <value id="central"/>
         <value id="backcentral"/>
         <value id="back"/>
      </feature>

      <feature id="manner">
         <value id="plosive"/>
         <value id="nasal"/>
         <value id="trill"/>
         <value id="flap"/>
         <value id="latflap"/>
         <value id="fricative"/>
         <value id="latfric"/>
         <value id="approximant"/>
         <value id="latapprox"/>

         <value id="click"/>
         <value id="implosive"/>
         <value id="ejective"/>

         <value id="affricate"/>
         <value id="diphthong"/>

         <value id="vocalic"/>
      </feature>

      <feature id="height">
         <value id="close"/>
         <value id="closeclosemid"/>
         <value id="closemid"/>
         <value id="mid"/>
         <value id="openmid"/>
         <value id="openopenmid"/>
         <value id="open"/>
      </feature>

      <feature id="voicing">
         <value id="voiceless"/>
         <value id="whispered"/>
         <value id="voiced"/>
      </feature>

      <feature id="stressed"/>

      <feature id="hardness">
         <value id="hard"/>
         <value id="soft"/>
      </feature>

      <feature id="rounded"/>

      <feature id="length">
         <value id="short"/>
         <value id="long"/>
      </feature>

      <!-- Not currently needed -->
      <feature id="tense"/>

      <!-- Word features -->
      <feature id="wordclass">
         <value id="particle"/>
         <value id="conjunction"/>
         <value id="noun"/>
         <value id="number"/>
         <value id="adjective"/>
         <value id="adverb"/>
         <value id="verb"/>
      </feature>

      <!-- Noun features -->
      <feature id="number">
         <value id="singular" />
         <value id="plural" />
      </feature>

      <feature id="person">
         <value id="1" />
         <value id="2i" />
         <value id="2f" />
         <value id="3" />
      </feature>
      
      <feature id="possessor" alias="person" />

      <feature id="case">
         <value id="nominative" />
         <value id="ablative" />
         <value id="locative" />
         <value id="dative" />
         <value id="genitive" />
         <value id="accusative" />
         <value id="instrumental" />
         <!-- Not traditionally considered a case
              but does not combine with any others -->
         <value id="possessive" />
      </feature>

      <!-- Verb features -->
      <feature id="tense">
         <!-- TODO -->
      </feature>

      <!-- General features -->
      <feature id="foreign"/>
   </features>

   <!-- Mapping between abstract phonemes and
        concrete realisations based upon context.

        Phonemes provide features common to all their realisations.
        If a phoneme has only one realisation, it may choose to omit
        phones.

        Each phone provides only the features unique to it, as well
        as an optional list of contexts that can trigger it.

        Dipthongs provide two sets of properties, one for each component.
        The algorithm then picks specific phones based upon requested features

        TODO diphthong handling, probably need a separate term for diphthongs and affricates
   -->
   <phonemes>
      <phoneme provide="voicing/voiced manner/vocalic height/open !rounded" id="aschwa">
         <phone provide="hardness/hard place/back">
            <ipa>ɑ</ipa>
         </phone>

         <phone provide="place/front foreign">
            <ipa>a</ipa>
         </phone>

         <phone provide="hardness/soft place/front">
            <ipa>æ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced place/bilabial" id="b">
         <phone provide="manner/fricative !foreign">
            <context before="[]||manner/vocalic" after="manner/vocalic"/>
            <ipa>β</ipa>
         </phone>

         <phone provide="manner/plosive">
            <ipa>b</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced manner/fricative place/labiodental foreign" id="v">
         <ipa>v</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced" id="ggh">
         <phone provide="hardness/soft manner/plosive place/velar">
            <ipa>g</ipa>
         </phone>

         <phone provide="hardness/hard manner/fricative place/uvular">
            <ipa>ʁ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced manner/plosive place/alveolar" id="d">
         <ipa>d</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced hardness/soft !rounded" id="je">
         <phone provide="manner/diphthong stressed">
            <diphthong start="place/palatal manner/approximant" end="manner/vocalic height/closemid place/front"/>
            <or>
               <context dialect="urban"/>
               <context after="[]||manner/vocalic"/>
            </or>
            <ipa>je</ipa>
         </phone>

         <phone provide="manner/diphthong !stressed">
            <diphthong start="place/palatal manner/approximant" end="manner/vocalic height/mid place/central"/>
            <or>
               <context after="[]||manner/vocalic"/>
               <context dialect="urban"/>
            </or>
            <ipa>jɘ</ipa>
         </phone>

         <phone provide="manner/vocalic height/closemid place/front stressed">
            <ipa>e</ipa>
         </phone>

         <phone provide="manner/vocalic height/mid place/central !stressed">
            <ipa>ɘ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced" id="zh">
         <phone provide="manner/affricate">
            <affricate start="place/alveolar" end="place/postalveolar"/>
            <context dialect="south"/>
            <ipa>dʒ</ipa>
         </phone>

         <phone provide="manner/approximant place/palatal">
            <context dialect="west"/>
            <ipa>j</ipa>
         </phone>

         <phone provide="foreign manner/fricative place/retroflex">
            <ipa>ʐ</ipa>
         </phone>

         <phone provide="manner/fricative place/postalveolar">
            <ipa>ʒ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced manner/fricative place/alveolar" id="z">
         <ipa>z</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced manner/approximant place/palatal" id="j">
         <ipa>j</ipa>
      </phoneme>

      <phoneme provide="voicing/unvoiced manner/plosive" id="kq">
         <phone provide="hardness/soft place/velar">
            <ipa>k</ipa>
         </phone>

         <phone provide="hardness/hard place/uvular aspirated">
            <context before="voicing/vocalic"/>
            <ipa>q^h</ipa>
         </phone>

         <phone provide="hardness/hard place/uvular !aspirated">
            <ipa>q</ipa>
         </phone>

         <phone provide="hardness/hard place/glottal">
            <context before="[]"/>
            <ipa>ʔ</ipa>
         </phone>
      </phoneme>

      <phoneme id="l">
         <phone provide="manner/diphthong hardness/hard">
            <diphthong start="voicing/vocalic height/close place/back !rounded" end="voicing/voiced place/alveolar manner/latapprox"/>
            <context after="!voicing/vocalic"/>
            <ipa>ɯl</ipa>
         </phone>

         <phone provide="manner/diphthong hardness/soft">
            <diphthong start="voicing/vocalic height/closeclosemid place/front !rounded" end="voicing/voiced place/alveolar manner/latapprox"/>
            <context after="!voicing/vocalic"/>
            <ipa>ɪl</ipa>
         </phone>

         <phone provide="voicing/voiced place/alveolar manner/latapprox">
            <ipa>l</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced manner/nasal place/bilabial" id="m">
         <ipa>m</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced manner/nasal place/alveolar" id="n">
         <ipa>n</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced manner/nasal" id="ng">
         <phone provide="place/velar">
            <context after="manner/vocalic"/>
            <ipa>ŋ</ipa>
         </phone>

         <phone provide="place/uvular">
            <ipa>ɴ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiced" id="ooe">
         <phone provide="manner/diphthong hardness/hard">
            <diphthong start="manner/approximant place/labialvelar" end="manner/vocalic place/back height/closemid rounded"/>
            <context after="[]|manner/vocalic"/>
            <ipa>^wo</ipa>
         </phone>

         <phone provide="manner/diphthong hardness/soft">
            <diphthong start="manner/approximant place/labialvelar" end="manner/vocalic place/front height/closemid rounded"/>
            <context after="[]|manner/vocalic"/>
            <ipa>^wø</ipa>
         </phone>

         <phone provide="hardness/hard manner/vocalic place/back height/closemid rounded">
            <ipa>o</ipa>
         </phone>

         <phone provide="hardness/hard manner/vocalic place/front height/closemid rounded">
            <ipa>ø</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/plosive place/bilabial" id="p">
         <ipa>p</ipa>
      </phoneme>

      <phoneme id="r">
         <phone provide="manner/diphthong hardness/hard">
            <diphthong start="voicing/vocalic height/close place/back !rounded" end="voicing/voiced manner/flap place/alveolar"/>
            <context after="!voicing/vocalic"/>
            <ipa>ɯɾ</ipa>
         </phone>

         <phone provide="manner/diphthong hardness/soft">
            <diphthong start="voicing/vocalic height/closeclosemid place/front !rounded" end="voicing/voiced manner/flap place/alveolar"/>
            <context after="!voicing/vocalic"/>
            <ipa>ɪɾ</ipa>
         </phone>

         <phone provide="voicing/voiced manner/flap place/alveolar">
            <ipa>ɾ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/fricative place/alveolar" id="s">
         <ipa>s</ipa>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/plosive place/alveolar" id="t">
         <ipa>t</ipa>
      </phoneme>

      <!-- TODO is this really a separate phoneme? -->
      <phoneme provide="soundclass/sonorant" id="u">
         <context after="[]" before="soundclass/vowel">w</context>
         <context syllable="contains:hardness/hard">ʊw</context>
         <context syllable="contains:hardness/soft">ʏw</context>
         <context word="contains:foreign">u / ʊ</context>
      </phoneme>

      <phoneme provide="voicing/voiced manner/vocalic height/closeclosemid rounded" id="ooue">
         <phone provide="hardness/hard place/backcentral">
            <ipa>ʊ</ipa>
         </phone>
         
         <phone provide="hardness/soft place/frontcentral">
            <ipa>ʏ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="foreign voicing/voiceless place/bilabial" id="f">
         <phone provide="manner/plosive">
            <ipa>p</ipa>
         </phone>

         <phone provide="manner/fricative">
            <context before="manner/vocalic rounded"/>
            <ipa>ɸ</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiceless" id="khh">
         <phone provide="manner/fricative place/uvular">
            <ipa>χ</ipa>
         </phone>

         <phone provide="foreign manner/fricative place/velar">
            <ipa>x</ipa>
         </phone>

         <phone provide="foreign manner/fricative place/glottal">
            <ipa>h</ipa>
         </phone>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/affricate foreign" id="ts">
         <affricate start="place/alveolar" end="place/alveolar"/>
         <ipa>t͡s</ipa>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/affricate foreign" id="ch">
         <affricate start="place/alveolar" end="place/postalveolar"/>
         <ipa>t͡ʃ</ipa>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/fricative place/postalveolar" id="sh">
         <ipa>ʃ</ipa>
      </phoneme>

      <phoneme provide="voicing/voiceless manner/fricative place/postalveolar length/long" id="shsh">
         <ipa>ʃː</ipa>
      </phoneme>

      <phoneme provide="voicing/voiced manner/vocalic length/short" id="yi">
         <phone provide="hardness/hard height/closeclosemid place/frontcentral">
            <ipa>ɯ</ipa>
         </phone>

         <phone provide="hardness/soft height/close place/back">
            <ipa>ɪ</ipa>
         </phone>
      </phoneme>

      <!-- ё, и, ъ, ь, э, ю, я are not phonemes -->
   </phonemes>

   <!-- Contextual mapping between letters and abstract
        phonemes.
        Note: Forms and rules are given using letters, not phonemes.
   -->
   <letters>
      <letter variants="А а" require="hardness/hard">aschwa</letter>
      <letter variants="Ә ә" require="hardness/soft">aschwa</letter>
      <letter variants="Б б">b</letter>
      <letter variants="Г г" require="hardness/soft">ggh</letter>
      <letter variants="Ғ ғ" require="hardness/hard">ggh</letter>
      <letter variants="Д д">d</letter>
      <letter variants="Е е">je</letter>
      <letter variants="Ё ё" require="hardness/hard">j ooe</letter>
      <letter variants="Ж ж">zh</letter>
      <letter variants="З з">z</letter>
      <letter variants="И и">yi j</letter>
      <letter variants="Й й">j</letter>
      <letter variants="К к" require="hardness/hard">kq</letter>
      <letter variants="Қ қ" require="hardness/soft">kq</letter>
      <letter variants="Л л">l</letter>
      <letter variants="М м">m</letter>
      <letter variants="Н н">n</letter>
      <letter variants="Ң ң">ng</letter>
      <letter variants="О о" require="hardness/hard">ooe</letter>
      <letter variants="Ө ө" require="hardness/soft">ooe</letter>
      <letter variants="П п">p</letter>
      <letter variants="Р р">r</letter>
      <letter variants="С с">s</letter>
      <letter variants="Т т">t</letter>
      <letter variants="У у">u</letter>
      <letter variants="Ұ ұ" require="hardness/hard">ooue</letter>
      <letter variants="Ү ү" require="hardness/soft">ooue</letter>
      <letter variants="Ф ф">f</letter>
      <letter variants="Х х">khh</letter>
      <letter variants="Һ һ" require="foreign">khh</letter>
      <letter variants="Ц ц">ts</letter>
      <letter variants="Ч ч">ch</letter>
      <letter variants="Ш ш">sh</letter>
      <letter variants="Щ щ">shsh</letter>
      <letter variants="Ъ ъ"/>
      <letter variants="Ы ы" require="hardness/hard">yi</letter>
      <letter variants="І і" require="hardness/soft">yi</letter>
      <letter variants="Ь ь"/>
      <letter variants="Э э">e</letter>
      <letter variants="Ю ю">j u</letter>
      <letter variants="Я я" require="hardness/hard">j aschwa</letter>
   </letters>

   <!-- Rules (used for mutation) -->
   <rules>
      <rule id="harmony1">
         <context before="!soundclass/plosive">hardness/soft</context>
      </rule>
   </rules>

   <!-- Definition of affixal and combinatory forms -->
   <forms>
      <form require="wordclass/noun" provide="number/singular" id="singular">
         <suffix/>
      </form>
      <form require="wordclass/noun" provide="number/plural" id="plural">
         <suffix rule="harmony1">дар</suffix>
      </form>
   </forms>
</grammar>
